<!doctype html>
<html lang="pl" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SzablonyTeam - najszybÅ›i w polsce â€” katalog</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Katalog szablonÃ³w Discord z moÅ¼liwoÅ›ciÄ… dodawania.">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
</head>
<body>
<header class="container header">
  <div class="brand">
    <img src="server-icon.gif" alt="Ikona serwera" class="logo"/>
    <div>
      <h1>SzablonTeam</h1>
      <p class="sub">Dodawaj i przeglÄ…daj szablony serwerÃ³w Discord.</p>
    </div>
  </div>

  <nav class="tabs">
    <button class="tab active" data-tab="catalog">ğŸ“š Katalog</button>
    <button class="tab" data-tab="discord">ğŸ—¨ï¸ Discord</button>
  </nav>

  <div class="controls">
    <div class="theme-toggle" title="Tryb dzieÅ„ / noc">
      <input type="checkbox" id="themeSwitch" />
      <label for="themeSwitch"><span>ğŸŒ</span><span>ğŸŒœ</span></label>
    </div>
  </div>
</header>

<main class="container">
  <section id="tab-catalog" class="tabpanel active">
    <form id="searchForm" class="toolbar" onsubmit="return false;">
      <input id="q" type="search" placeholder="Szukaj...">
      <button id="btnSearch" type="button">ğŸ” Szukaj</button>
    </form>

    <section class="add-section">
      <div class="add-head">
        <h2>â• Dodaj nowy szablon</h2>
        <div class="lock">
          <input type="password" id="unlockPwd" placeholder="HasÅ‚o, aby odblokowaÄ‡" />
          <button id="unlockBtn" type="button">ğŸ”“ Odblokuj</button>
        </div>
      </div>
      <p class="hint">Dodawanie jest zablokowane hasÅ‚em</p>
      <form id="addForm" class="add-form locked" aria-disabled="true">
        <input type="text" id="code" placeholder="discord.new/XXXXX" required disabled>
        <input type="text" id="title" placeholder="TytuÅ‚" required disabled>
        <textarea id="desc" placeholder="Opis" disabled></textarea>
        <input type="text" id="tags" placeholder="Tagi (oddzielone przecinkami)" disabled>
        <button type="submit" disabled>Dodaj szablon</button>
      </form>
    </section>

    <div id="stats" class="meta"></div>
    <section id="grid" class="grid" aria-live="polite"></section>
    <div id="pager" class="pagination"></div>
  </section>

  <section id="tab-discord" class="tabpanel">
    <div class="discord-card">
      <img src="server-icon.gif" alt="Ikona serwera" class="discord-icon">
      <div class="discord-info">
        <h2>Nasz serwer Discord</h2>
        <p class="desc">
          DoÅ‚Ä…cz do naszej spoÅ‚ecznoÅ›ci â€” znajdziesz tu aktualne szablony, pomoc oraz ogÅ‚oszenia.
        </p>
        <ul class="bullets">
          <li>AktualnoÅ›ci o nowych szablonach</li>
          <li>Wsparcie i feedback</li>
          <li>Konkursy i ogÅ‚oszenia</li>
        </ul>
        <a id="inviteBtn" class="btn big" target="_blank" rel="noopener">âœ¨ DoÅ‚Ä…cz na Discorda !</a>
      </div>
    </div>
  </section>
</main>

<footer class="container footer">
  <p>Static HTML+CSS+JS. Motyw zapamiÄ™tywany w przeglÄ…darce.</p>
</footer>

<script>
const DISCORD_INVITE_URL = "https://discord.gg/szablonyteam";
const ADD_PASSWORD = "dupaguwno";

const PAGE_SIZE = 12;
let fuse;

const html = document.documentElement;
const themeSwitch = document.getElementById('themeSwitch');
function setTheme(mode) {
  html.setAttribute('data-theme', mode);
  localStorage.setItem('theme', mode);
  themeSwitch.checked = mode === 'dark';
}
themeSwitch.addEventListener('change', () => setTheme(themeSwitch.checked ? 'dark' : 'light'));
setTheme(localStorage.getItem('theme') || 'light');

const tabs = document.querySelectorAll('.tab');
const tabpanels = document.querySelectorAll('.tabpanel');
tabs.forEach(t => t.addEventListener('click', () => {
  tabs.forEach(x=>x.classList.remove('active'));
  tabpanels.forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  document.getElementById('tab-' + t.dataset.tab).classList.add('active');
  if (t.dataset.tab === 'discord') {
    document.getElementById('inviteBtn').setAttribute('href', DISCORD_INVITE_URL);
  }
}));

async function loadData() {
  const res = await fetch('templates.json');
  const data = await res.json();
  return data.map(it => ({
    code: it.code,
    title: it.title || '',
    description: it.description || '',
    tags: Array.isArray(it.tags) ? it.tags : [],
    url: it.url || ('https://discord.new/' + it.code)
  }));
}
function refreshFuse(data) {
  fuse = new Fuse(data, { keys: ['title','description','tags'], threshold: 0.35 });
}
function filterData(all) {
  const q = document.getElementById('q').value.trim();
  if (!q) return all;
  return fuse.search(q).map(r => r.item);
}
function renderPage(items, page=1) {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  const start = (page-1) * PAGE_SIZE;
  const slice = items.slice(start, start+PAGE_SIZE);
  for (const it of slice) {
    const card = document.createElement('article');
    card.className = 'card fadein';
    card.innerHTML = `
      <div class="card-head">
        <h3>${it.title || 'Bez tytuÅ‚u'}</h3>
        <div class="tags">${(it.tags||[]).map(t=>`<span>${t}</span>`).join('')}</div>
      </div>
      <p class="desc">${(it.description||'').slice(0,180)}${(it.description||'').length>180?'â€¦':''}</p>
      <a class="btn" target="_blank" href="${it.url}">UÅ¼yj szablonu</a>`;
    grid.appendChild(card);
  }
}
function updateStats(filtered, total) {
  const stats = document.getElementById('stats');
  const pages = Math.max(1, Math.ceil(filtered.length/PAGE_SIZE));
  stats.textContent = `ÅÄ…cznie: ${filtered.length} z ${total} â€¢ Strony: ${pages}`;
}
function doRender(all) {
  const filtered = filterData(all);
  renderPage(filtered,1);
  updateStats(filtered,all.length);
}

const addForm = document.getElementById('addForm');
const unlockBtn = document.getElementById('unlockBtn');
const unlockPwd = document.getElementById('unlockPwd');

function setLocked(isLocked) {
  addForm.classList.toggle('locked', isLocked);
  addForm.setAttribute('aria-disabled', isLocked ? 'true' : 'false');
  [...addForm.elements].forEach(el => el.disabled = isLocked);
}
function isUnlocked() { return sessionStorage.getItem('unlocked') === '1'; }
if (isUnlocked()) { setLocked(false); }

unlockBtn.addEventListener('click', () => {
  if (unlockPwd.value === ADD_PASSWORD) {
    sessionStorage.setItem('unlocked','1');
    setLocked(false);
    unlockPwd.value='';
  } else {
    unlockPwd.classList.add('shake');
    setTimeout(()=>unlockPwd.classList.remove('shake'), 500);
  }
});

document.addEventListener("DOMContentLoaded", () => {
  loadData().then(all => {
    window.__ALL__ = all;
    refreshFuse(all);
    doRender(all);
  });

  document.getElementById('btnSearch').addEventListener('click', () => doRender(window.__ALL__||[]));
  document.getElementById('q').addEventListener('input', () => doRender(window.__ALL__||[]));

  addForm.addEventListener('submit', (e) => {
    e.preventDefault();
    if (!isUnlocked()) return;
    const code = document.getElementById('code').value.trim().replace('https://discord.new/','');
    const title = document.getElementById('title').value.trim();
    const description = document.getElementById('desc').value.trim();
    const tags = document.getElementById('tags').value.split(',').map(t=>t.trim()).filter(Boolean);
    if (!code || !title) return;
    const newTemplate = { code, title, description, tags, url: 'https://discord.new/'+code };
    window.__ALL__.unshift(newTemplate);
    refreshFuse(window.__ALL__);
    doRender(window.__ALL__);
    e.target.reset();
  });
});
</script>
</body>
</html>

